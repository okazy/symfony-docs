

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The Mailer Component &mdash; [Unofficial] Symfony Framework Documentation (ja)  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/rtd_custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Messenger Component" href="messenger.html" />
    <link rel="prev" title="The Lock Component" href="lock.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #f0f0f0" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/symfony-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_tour/index.html">The Quick Tour</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../best_practices.html">The Symfony Framework Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundles.html">The Bundle System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cache.html">Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console.html">Console Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doctrine.html">Databases and the Doctrine ORM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">How to Deploy a Symfony Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../email.html">Swift Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event_dispatcher.html">Events and Event Listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../forms.html">Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontend.html">Managing CSS and JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache.html">HTTP Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_client.html">HTTP Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mailer.html">Sending Emails with Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mercure.html">Pushing Data to Clients Using the Mercure Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../messenger.html">Messenger: Sync &amp; Queued Message Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">Migrating an Existing Application to Symfony</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notifier.html">Creating and Sending Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiler.html">Profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../routing.html">Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Installing &amp; Setting up the Symfony Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serializer.html">How to Use the Serializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../service_container.html">Service Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../translation.html">Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web_link.html">Asset Preloading and Resource Hints with HTTP/2 and WebLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">Workflow</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="using_components.html">How to Install and Use the Symfony Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="asset.html">The Asset Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="browser_kit.html">The BrowserKit Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="cache.html">The Cache Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">The Config Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="console.html">The Console Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="contracts.html">The Contracts Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="css_selector.html">The CssSelector Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="dependency_injection.html">The DependencyInjection Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="dom_crawler.html">The DomCrawler Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_dispatcher.html">The EventDispatcher Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression_language.html">The ExpressionLanguage Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="filesystem.html">The Filesystem Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="finder.html">The Finder Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="form.html">The Form Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="http_foundation.html">The HttpFoundation Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="http_kernel.html">The HttpKernel Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="inflector.html">The Inflector Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="intl.html">The Intl Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="ldap.html">The Ldap Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="lock.html">The Lock Component</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The Mailer Component</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transport">Transport</a></li>
<li class="toctree-l3"><a class="reference internal" href="#high-availability">High Availability</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-balancing">Load Balancing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tls-peer-verification">TLS Peer Verification</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sending-emails-asynchronously">Sending emails asynchronously</a></li>
<li class="toctree-l3"><a class="reference internal" href="#learn-more">Learn More</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="messenger.html">The Messenger Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="mime.html">The Mime Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="options_resolver.html">The OptionsResolver Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="phpunit_bridge.html">The PHPUnit Bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="process.html">The Process Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="property_access.html">The PropertyAccess Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="property_info.html">The PropertyInfo Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="psr7.html">The PSR-7 Bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">The Security Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="serializer.html">The Serializer Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="stopwatch.html">The Stopwatch Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="string.html">The String Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="uid.html">The UID Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="validator.html">The Validator Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="var_dumper.html">The VarDumper Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="var_exporter.html">The VarExporter Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="workflow.html">The Workflow Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="yaml.html">The Yaml Component</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Documents</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../create_framework/index.html">Create your own PHP Framework</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">[Unofficial] Symfony Framework Documentation (ja)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">The Components</a> &raquo;</li>
        
      <li>The Mailer Component</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/components/mailer.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-mailer-component">
<span id="index-0"></span><h1>The Mailer Component<a class="headerlink" href="#the-mailer-component" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div>The Mailer component helps sending emails.</div></blockquote>
<p>If you’re using the Symfony Framework, read the
<a class="reference internal" href="../mailer.html"><span class="doc">Symfony Framework Mailer documentation</span></a>.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="highlight-terminal notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require symfony/mailer
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you install this component outside of a Symfony application, you must
require the <code class="docutils literal notranslate"><span class="pre">vendor/autoload.php</span></code> file in your code to enable the class
autoloading mechanism provided by Composer. Read
<a class="reference internal" href="using_components.html"><span class="doc">this article</span></a> for more details.</p>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The Mailer component has two main classes: a <code class="docutils literal notranslate"><span class="pre">Transport</span></code> and the <code class="docutils literal notranslate"><span class="pre">Mailer</span></code> itself:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Mailer\Mailer</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\Transport\Smtp\EsmtpTransport</span><span class="p">;</span>

<span class="nv">$transport</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EsmtpTransport</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">);</span>
<span class="nv">$mailer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mailer</span><span class="p">(</span><span class="nv">$transport</span><span class="p">);</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">$email</span></code> object is created via the <a class="reference internal" href="mime.html"><span class="doc">Mime component</span></a>.</p>
</div>
<div class="section" id="transport">
<h2>Transport<a class="headerlink" href="#transport" title="Permalink to this headline">¶</a></h2>
<p>The only transport that comes pre-installed is SMTP.</p>
<p>Below is the list of other popular providers with built-in support:</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Service</th>
<th class="head">Install with</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Amazon SES</td>
<td><code class="docutils literal notranslate"><span class="pre">composer</span> <span class="pre">require</span> <span class="pre">symfony/amazon-mailer</span></code></td>
</tr>
<tr class="row-odd"><td>Gmail</td>
<td><code class="docutils literal notranslate"><span class="pre">composer</span> <span class="pre">require</span> <span class="pre">symfony/google-mailer</span></code></td>
</tr>
<tr class="row-even"><td>MailChimp</td>
<td><code class="docutils literal notranslate"><span class="pre">composer</span> <span class="pre">require</span> <span class="pre">symfony/mailchimp-mailer</span></code></td>
</tr>
<tr class="row-odd"><td>Mailgun</td>
<td><code class="docutils literal notranslate"><span class="pre">composer</span> <span class="pre">require</span> <span class="pre">symfony/mailgun-mailer</span></code></td>
</tr>
<tr class="row-even"><td>Postmark</td>
<td><code class="docutils literal notranslate"><span class="pre">composer</span> <span class="pre">require</span> <span class="pre">symfony/postmark-mailer</span></code></td>
</tr>
<tr class="row-odd"><td>SendGrid</td>
<td><code class="docutils literal notranslate"><span class="pre">composer</span> <span class="pre">require</span> <span class="pre">symfony/sendgrid-mailer</span></code></td>
</tr>
</tbody>
</table>
<p>For example, suppose you want to use Google’s Gmail SMTP server. First, install
it:</p>
<div class="highlight-terminal notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require symfony/google-mailer
</pre></div>
</td></tr></table></div>
<p>Then, use the SMTP Gmail transport:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Mailer\Bridge\Google\Transport\GmailSmtpTransport</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\Mailer</span><span class="p">;</span>

<span class="nv">$transport</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GmailSmtpTransport</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">);</span>
<span class="nv">$mailer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mailer</span><span class="p">(</span><span class="nv">$transport</span><span class="p">);</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>
</pre></div>
</div>
<p>Each provider provides up to 3 transports: standard SMTP, HTTP (it uses the
provider’s API but the body is created by the mailer component), API (it uses
the full API of the provider with no control over the body creation – features
might be limited as well).</p>
<p id="mailer-dsn">The mailer component provides a convenient way to create a transport from a
DSN:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Mailer\Transport</span><span class="p">;</span>

<span class="nv">$transport</span> <span class="o">=</span> <span class="nx">Transport</span><span class="o">::</span><span class="na">fromDsn</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">);</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">$dsn</span></code> depends on the provider you want to use. For plain SMTP, use
<code class="docutils literal notranslate"><span class="pre">smtp://user:pass&#64;example.com</span></code> or <code class="docutils literal notranslate"><span class="pre">sendmail+smtp://default</span></code> to use the
<code class="docutils literal notranslate"><span class="pre">sendmail</span></code> binary. To disable the transport, use <code class="docutils literal notranslate"><span class="pre">null://null</span></code>.</p>
<p>For third-party providers, refer to the following table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="29%" />
<col width="30%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Provider</th>
<th class="head">SMTP</th>
<th class="head">HTTP</th>
<th class="head">API</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Amazon SES</td>
<td>ses+smtp://ACCESS_KEY:SECRET_KEY&#64;default</td>
<td>ses+https://ACCESS_KEY:SECRET_KEY&#64;default</td>
<td>ses+api://ACCESS_KEY:SECRET_KEY&#64;default</td>
</tr>
<tr class="row-odd"><td>Google Gmail</td>
<td>gmail+smtp://USERNAME:PASSWORD&#64;default</td>
<td>n/a</td>
<td>n/a</td>
</tr>
<tr class="row-even"><td>Mailchimp Mandrill</td>
<td>mandrill+smtp://USERNAME:PASSWORD&#64;default</td>
<td>mandrill+https://KEY&#64;default</td>
<td>mandrill+api://KEY&#64;default</td>
</tr>
<tr class="row-odd"><td>Mailgun</td>
<td>mailgun+smtp://USERNAME:PASSWORD&#64;default</td>
<td>mailgun+https://KEY:DOMAIN&#64;default</td>
<td>mailgun+api://KEY:DOMAIN&#64;default</td>
</tr>
<tr class="row-even"><td>Postmark</td>
<td>postmark+smtp://ID:ID&#64;default</td>
<td>n/a</td>
<td>postmark+api://KEY&#64;default</td>
</tr>
<tr class="row-odd"><td>Sendgrid</td>
<td>sendgrid+smtp://apikey:KEY&#64;default</td>
<td>n/a</td>
<td>sendgrid+api://KEY&#64;default</td>
</tr>
</tbody>
</table>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">If your credentials contain special characters, you must URL-encode them.
For example, the DSN <code class="docutils literal notranslate"><span class="pre">ses+smtp://ABC1234:abc+12/345&#64;default</span></code> should be
configured as <code class="docutils literal notranslate"><span class="pre">ses+smtp://ABC1234:abc%2B12%2F345&#64;default</span></code></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When using SMTP, the default timeout for sending a message before throwing an
exception is the value defined in the <a class="reference external" href="https://www.php.net/manual/en/filesystem.configuration.php#ini.default-socket-timeout">default_socket_timeout</a> PHP.ini option.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 5.1: </span>The usage of <code class="docutils literal notranslate"><span class="pre">default_socket_timeout</span></code> as the default timeout was
introduced in Symfony 5.1.</p>
</div>
</div>
<p>Instead of choosing a specific protocol, you can also let Symfony pick the
best one by omitting it from the scheme: for instance, <code class="docutils literal notranslate"><span class="pre">mailgun://KEY:DOMAIN&#64;default</span></code>
is equivalent to <code class="docutils literal notranslate"><span class="pre">mailgun+https://KEY:DOMAIN&#64;default</span></code>.</p>
<p>If you want to override the default host for a provider (to debug an issue using
a service like <code class="docutils literal notranslate"><span class="pre">requestbin.com</span></code>), change <code class="docutils literal notranslate"><span class="pre">default</span></code> by your host:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>mailgun+https://KEY:DOMAIN@example.com
mailgun+https://KEY:DOMAIN@example.com:99
</pre></div>
</td></tr></table></div>
<p>Note that the protocol is <em>always</em> HTTPs and cannot be changed.</p>
</div>
<div class="section" id="high-availability">
<h2>High Availability<a class="headerlink" href="#high-availability" title="Permalink to this headline">¶</a></h2>
<p>Symfony’s mailer supports <a class="reference external" href="https://en.wikipedia.org/wiki/High_availability">high availability</a> via a technique called “failover”
to ensure that emails are sent even if one mailer server fails .</p>
<p>A failover transport is configured with two or more transports and the
<code class="docutils literal notranslate"><span class="pre">failover</span></code> keyword:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$dsn</span> <span class="o">=</span> <span class="s1">&#39;failover(postmark+api://ID@default sendgrid+smtp://KEY@default)&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>The mailer will start using the first transport. If the sending fails, the
mailer won’t retry it with the other transports, but it will switch to the next
transport automatically for the following deliveries.</p>
</div>
<div class="section" id="load-balancing">
<h2>Load Balancing<a class="headerlink" href="#load-balancing" title="Permalink to this headline">¶</a></h2>
<p>Symfony’s mailer supports <a class="reference external" href="https://en.wikipedia.org/wiki/Load_balancing_(computing)">load balancing</a> via a technique called “round-robin”
to distribute the mailing workload across multiple transports .</p>
<p>A round-robin transport is configured with two or more transports and the
<code class="docutils literal notranslate"><span class="pre">roundrobin</span></code> keyword:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$dsn</span> <span class="o">=</span> <span class="s1">&#39;roundrobin(postmark+api://ID@default sendgrid+smtp://KEY@default)&#39;</span>
</pre></div>
</div>
<p>The mailer will start using a randomly selected transport and if it fails, it
will retry the same delivery with the next transports until one of them succeeds
(or until all of them fail).</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 5.1: </span>The random selection of the first transport was introduced in Symfony 5.1.
In previous Symfony versions the first transport was always selected first.</p>
</div>
</div>
<div class="section" id="tls-peer-verification">
<h2>TLS Peer Verification<a class="headerlink" href="#tls-peer-verification" title="Permalink to this headline">¶</a></h2>
<p>By default, SMTP transports perform TLS peer verification. This behavior is
configurable with the <code class="docutils literal notranslate"><span class="pre">verify_peer</span></code> option. Although it’s not recommended to
disable this verification for security reasons, it can be useful while developing
the application or when using a self-signed certificate:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$dsn</span> <span class="o">=</span> <span class="s1">&#39;smtp://user:pass@smtp.example.com?verify_peer=false&#39;</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 5.1: </span>The <code class="docutils literal notranslate"><span class="pre">verify_peer</span></code> option was introduced in Symfony 5.1.</p>
</div>
</div>
<div class="section" id="sending-emails-asynchronously">
<h2>Sending emails asynchronously<a class="headerlink" href="#sending-emails-asynchronously" title="Permalink to this headline">¶</a></h2>
<p>If you want to send emails asynchronously, install the <a class="reference internal" href="messenger.html"><span class="doc">Messenger component</span></a>.</p>
<div class="highlight-terminal notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require symfony/messenger
</pre></div>
</td></tr></table></div>
<p>Then, instantiate and pass a <code class="docutils literal notranslate"><span class="pre">MessageBus</span></code> as a second argument to <code class="docutils literal notranslate"><span class="pre">Mailer</span></code>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Mailer\Envelope</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\Mailer</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\Messenger\MessageHandler</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\Messenger\SendEmailMessage</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\Transport</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Messenger\Handler\HandlersLocator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Messenger\MessageBus</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Messenger\Middleware\HandleMessageMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mime\Address</span><span class="p">;</span>

<span class="nv">$dsn</span> <span class="o">=</span> <span class="s1">&#39;change-dsn-accordingly&#39;</span><span class="p">;</span>

<span class="nv">$transport</span> <span class="o">=</span> <span class="nx">Transport</span><span class="o">::</span><span class="na">fromDsn</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">);</span>
<span class="nv">$handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageHandler</span><span class="p">(</span><span class="nv">$transport</span><span class="p">);</span>

<span class="nv">$bus</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageBus</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">HandleMessageMiddleware</span><span class="p">(</span><span class="k">new</span> <span class="nx">HandlersLocator</span><span class="p">([</span>
        <span class="nx">SendEmailMessage</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nv">$handler</span><span class="p">],</span>
    <span class="p">])),</span>
<span class="p">]);</span>

<span class="nv">$mailer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mailer</span><span class="p">(</span><span class="nv">$transport</span><span class="p">,</span> <span class="nv">$bus</span><span class="p">);</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>

<span class="c1">// you can pass an optional Envelope</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$email</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Envelope</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">Address</span><span class="p">(</span><span class="s1">&#39;sender@example.com&#39;</span><span class="p">),</span>
    <span class="p">[</span>
        <span class="k">new</span> <span class="nx">Address</span><span class="p">(</span><span class="s1">&#39;recipient@example.com&#39;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="learn-more">
<h2>Learn More<a class="headerlink" href="#learn-more" title="Permalink to this headline">¶</a></h2>
<p>To learn more about how to use the mailer component, refer to the
<a class="reference internal" href="../mailer.html"><span class="doc">Symfony Framework Mailer documentation</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright This work, including the code samples, is licensed under a Creative Commons BY-SA 3.0 license.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>